# Архитектуры агентов

В проекте реализованы **две архитектуры** агентов:

## 1. Supervisor-based (по умолчанию)

**Файл:** `orchestration/supervisor.py`

### Особенности:
- ✅ Один LLM (Claude через OpenRouter)
- ✅ LangGraph для оркестрации
- ✅ Автоматический выбор инструментов
- ✅ Параллельное выполнение инструментов
- ✅ Feedback loop для итеративного улучшения

### Поток:
```
User Input → Supervisor (Claude) → Tool Selection → ToolNode → Results → Supervisor → Response
```

### Инструменты:
- **GcodeAnalyzer** - анализ G-code файлов
- **RAGEngine** - поиск в базе знаний
- **VisionPipeline** - анализ изображений
- **HardwareInterface** - управление принтером

### Преимущества:
- Быстрая обработка
- Эффективное использование токенов
- Автоматический выбор нужных инструментов
- Поддержка сложных сценариев

---

## 2. MultiModel (опциональная)

**Файл:** `agents/multi_model_agent.py`

### Особенности:
- ✅ 4 роли с разными задачами
- ✅ Множественные вызовы LLM
- ✅ Упрощенная версия для новичков
- ✅ Оценка качества ответа

### Pipeline:
```
1. Аналитик → анализирует запрос, определяет нужную информацию
2. RAG → ищет в базе знаний
3. Консультант → готовит подробный технический ответ
4. Редактор → упрощает для новичков
5. Проверяющий → оценивает качество (correctness, completeness, clarity)
```

### Роли:

#### 1️⃣ Аналитик
- Анализирует запрос пользователя
- Определяет тип вопроса (материалы, дефекты, настройки)
- Выявляет необходимую информацию

#### 2️⃣ Консультант
- Готовит подробный технический ответ
- Использует информацию из базы знаний
- Дает конкретные рекомендации

#### 3️⃣ Редактор
- Упрощает технический ответ
- Адаптирует для новичков
- Убирает сложные термины

#### 4️⃣ Проверяющий
- Оценивает качество ответа
- Метрики: корректность, полнота, ясность
- Возвращает оценку 1-10 по каждому критерию

### Преимущества:
- Более структурированные ответы
- Адаптация под уровень пользователя
- Контроль качества
- Детальная обработка запросов

### Недостатки:
- Больше вызовов LLM (больше токенов)
- Медленнее обработка
- Выше стоимость

---

## Переключение между архитектурами

### Через .env:
```bash
# Supervisor-based (по умолчанию)
USE_MULTI_MODEL_AGENT=False

# MultiModel
USE_MULTI_MODEL_AGENT=True
```

### Программно:
```python
from agent import Agent

# Supervisor-based
agent = Agent(use_multi_model=False)

# MultiModel
agent = Agent(use_multi_model=True)
```

---

## Когда использовать какую архитектуру?

### Supervisor-based (рекомендуется):
- ✅ Быстрые ответы
- ✅ Экономия токенов
- ✅ Автоматический выбор инструментов
- ✅ Сложные сценарии с несколькими инструментами

### MultiModel:
- ✅ Нужна упрощенная версия для новичков
- ✅ Требуется контроль качества ответов
- ✅ Детальная обработка сложных вопросов
- ✅ Образовательные цели

---

## Примеры использования

### Supervisor-based:
```python
from agent import Agent

agent = Agent()  # По умолчанию Supervisor
response = await agent.run("Почему мой первый слой не прилипает?", session_id=1, db=db)
```

### MultiModel:
```python
from agent import Agent

agent = Agent(use_multi_model=True)
response = await agent.run("Почему мой первый слой не прилипает?", session_id=1, db=db)
# Ответ будет включать:
# - Подробный технический ответ
# - Упрощенную версию для новичков
# - Оценку качества
```

